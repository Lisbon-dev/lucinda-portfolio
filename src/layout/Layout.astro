---
import { ViewTransitions } from 'astro:transitions';
import Footer from "../components/layout/Footer.astro";

// SEO Props Interface
export interface SEOProps {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  type?: "website" | "article";
  noindex?: boolean;
  keywords?: string[];
}

interface Props {
  seo?: SEOProps;
}

// Extract SEO props with defaults
const { seo = {} } = Astro.props as Props;

// Default SEO values
const defaultSEO = {
  title:
    "Lucinda Burman - Editorial Illustration | Branding & Interior Artwork | 2D & 3D | Bespoke Commissions | Weddings & Events",
  description:
    "Professional editorial illustration, branding, and interior artwork by Lucinda Burman. Specializing in 2D & 3D design, bespoke commissions, weddings, and events. View portfolio of creative work.",
  image: "/portfolio-og-image.jpg", // We'll create this
  type: "website" as const,
  keywords: [
    "editorial illustration",
    "branding",
    "interior artwork",
    "2D design",
    "3D design",
    "bespoke commissions",
    "wedding illustration",
    "event design",
    "creative portfolio",
  ],
};

// Merge props with defaults
const currentSEO = {
  title: seo.title || defaultSEO.title,
  description: seo.description || defaultSEO.description,
  image: seo.image || defaultSEO.image,
  canonical: seo.canonical || Astro.url.href,
  type: seo.type || defaultSEO.type,
  noindex: seo.noindex || false,
  keywords: seo.keywords || defaultSEO.keywords,
};

// Ensure title is optimized for SEO (max 60 characters for optimal display)
const optimizedTitle =
  currentSEO.title.length > 60
    ? currentSEO.title.substring(0, 57) + "..."
    : currentSEO.title;

// Ensure description is optimized for SEO (max 155 characters)
const optimizedDescription =
  currentSEO.description.length > 155
    ? currentSEO.description.substring(0, 152) + "..."
    : currentSEO.description;

// Create absolute URLs for social media - handle both string URLs and Astro image objects
const imageUrl =
  typeof currentSEO.image === "string"
    ? currentSEO.image
    : currentSEO.image?.src || defaultSEO.image;

const absoluteImage = imageUrl.startsWith("http")
  ? imageUrl
  : new URL(imageUrl, Astro.site || Astro.url.origin).href;

const absoluteCanonical = currentSEO.canonical.startsWith("http")
  ? currentSEO.canonical
  : new URL(currentSEO.canonical, Astro.site || Astro.url.origin).href;

// Structured Data - Person/CreativeWork Schema
const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  name: "Lucinda Burman",
  jobTitle: "Editorial Illustrator & Creative Designer",
  description:
    "Professional editorial illustrator specializing in branding, interior artwork, 2D & 3D design, bespoke commissions, weddings, and events.",
  url: Astro.site?.href || Astro.url.origin,
  image: absoluteImage,
  sameAs: [
    // These will be updated with actual social media URLs
    "https://www.behance.net/lucindaburman",
    "https://www.linkedin.com/in/lucindaburman",
  ],
  knowsAbout: [
    "Editorial Illustration",
    "Branding Design",
    "Interior Artwork",
    "2D Design",
    "3D Design",
    "Wedding Illustration",
    "Event Design",
    "Bespoke Commissions",
  ],
  hasOccupation: {
    "@type": "Occupation",
    name: "Editorial Illustrator",
    occupationLocation: {
      "@type": "Place",
      name: "United Kingdom",
    },
  },
};

// Website Schema
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: "Lucinda Burman Portfolio",
  description: optimizedDescription,
  url: Astro.site?.href || Astro.url.origin,
  creator: {
    "@type": "Person",
    name: "Lucinda Burman",
  },
  inLanguage: "en-GB",
};

// Organization Schema (for business inquiries)
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: "Lucinda Burman Creative Services",
  description:
    "Professional creative services specializing in editorial illustration, branding, and bespoke design work.",
  url: Astro.site?.href || Astro.url.origin,
  founder: {
    "@type": "Person",
    name: "Lucinda Burman",
  },
  serviceType: [
    "Editorial Illustration",
    "Branding Design",
    "Interior Artwork",
    "Wedding Design",
    "Event Illustration",
  ],
};
---

<!doctype html>
<html lang="en-GB">
  <head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO Meta Tags -->
    <title>{optimizedTitle}</title>
    <meta name="description" content={optimizedDescription} />
    <meta name="keywords" content={currentSEO.keywords.join(", ")} />
    <link rel="canonical" href={absoluteCanonical} />

    <!-- Robots Meta Tag -->
    {currentSEO.noindex && <meta name="robots" content="noindex, nofollow" />}
    {!currentSEO.noindex && <meta name="robots" content="index, follow" />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={currentSEO.type} />
    <meta property="og:url" content={absoluteCanonical} />
    <meta property="og:title" content={optimizedTitle} />
    <meta property="og:description" content={optimizedDescription} />
    <meta property="og:image" content={absoluteImage} />
    <meta
      property="og:image:alt"
      content="Lucinda Burman Portfolio - Editorial Illustration and Creative Design"
    />
    <meta property="og:site_name" content="Lucinda Burman Portfolio" />
    <meta property="og:locale" content="en_GB" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={absoluteCanonical} />
    <meta property="twitter:title" content={optimizedTitle} />
    <meta property="twitter:description" content={optimizedDescription} />
    <meta property="twitter:image" content={absoluteImage} />
    <meta
      property="twitter:image:alt"
      content="Lucinda Burman Portfolio - Editorial Illustration and Creative Design"
    />

    <!-- Additional Meta Tags -->
    <meta name="author" content="Lucinda Burman" />
    <meta name="theme-color" content="#325C59" />
    <meta name="msapplication-TileColor" content="#325C59" />

    <!-- View Transitions -->
    <ViewTransitions />
    
    <!-- Close modals on navigation -->
    <script>
      document.addEventListener('astro:before-preparation', () => {
        // Close any open modals before navigation
        const openDialogs = document.querySelectorAll('dialog[open]');
        openDialogs.forEach(dialog => {
          dialog.close();
        });
      });
    </script>

    <!-- Structured Data -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify(personSchema)}
    />
    <script
      type="application/ld+json"
      set:html={JSON.stringify(websiteSchema)}
    />
    <script
      type="application/ld+json"
      set:html={JSON.stringify(organizationSchema)}
    />

    <!-- Critical Font Preloading & Optimization -->
    <!-- High-priority preconnects -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://use.typekit.net" crossorigin />

    <!-- Critical font preloading -->
    <link
      rel="preload"
      href="https://use.typekit.net/roo1sig.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link rel="stylesheet" href="https://use.typekit.net/roo1sig.css" />
    </noscript>

    <!-- Google Fonts with optimized loading -->
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=optional"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Unbounded:wght@200..900&display=optional"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Unbounded:wght@200..900&display=swap"
        rel="stylesheet"
      />
    </noscript>
  </head>

  <body>
    <slot />
  </body>
  <Footer />
</html>

<style is:global>
  @layer reset {
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    * {
      margin: 0;
      padding: 0;
    }

    html {
      /* Disable font size inflation on mobile. */
      text-size-adjust: none;
      -webkit-text-size-adjust: none;
    }

    body {
      line-height: 1.5;
      /* 
		Font synthesis is largely undesirable, 
		disable it to make it more obvious 
		when font styles are missing.
	*/
      font-synthesis: none;
    }

    img,
    picture,
    video,
    canvas,
    svg {
      display: block;
      max-inline-size: 100%;
    }

    input,
    button,
    textarea,
    select {
      font: inherit;
      letter-spacing: inherit;
      word-spacing: inherit;
      color: currentColor;
    }

    p,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      overflow-wrap: break-word;
    }

    ol,
    ul {
      list-style: none;
    }

    :not([class]) {
      h1&,
      h2&,
      h3&,
      h4&,
      h5&,
      h6& {
        margin-block: 0.75em;
        line-height: 1.25;
        text-wrap: balance;
        letter-spacing: -0.05ch;
      }

      p&,
      ol&,
      ul& {
        margin-block: 1em;
      }

      ol&,
      ul& {
        padding-inline-start: 1.5em;
        list-style: revert;
      }

      li& {
        margin-block: 0.5em;
      }
    }
  }

  :root {
    scrollbar-gutter: stable;

    /* Declare supported color schemes */
    color-scheme: light dark;

    /* Breakpoints */
    --breakpoint-xs: 320px;
    --breakpoint-sm: 430px;
    --breakpoint-base: 550px;
    --breakpoint-md: 768px;
    --breakpoint-lg: 900px;
    --breakpoint-xl: 1024px;
    --breakpoint-2xl: 1600px;

    /* Container widths */
    --container-xs: 100%;
    --container-sm: 95%;
    --container-base: 90%;
    --container-md: 85%;
    --container-lg: 80%;
    --container-xl: 75%;
    --container-2xl: 70%;

    /* Typography with Performance Optimization */
    --font-body: "ibm-plex-sans", "Montserrat", "Inter", sans-serif; /* Clean sans for body text */
    --font-heading: "ivypresto-display", "Times New Roman", serif;
    --font-sub-heading: "Lato", "Helvetica Neue", sans-serif;
    --font-lisbon-dev: "Unbounded", "Inter", sans-serif;

    /* Font fallback metrics for CLS prevention */
    --font-fallback-size-adjust: 100%;
    --font-hero-min-height: 200px; /* Reserve space during font loading */

    /* Font Sizes */
    --text-xxs: clamp(0.5rem, 0.4rem + 0.227vw, 0.705rem);
    --text-xs: clamp(0.75rem, 0.705rem + 0.227vw, 0.875rem);
    --text-sm: clamp(0.875rem, 0.83rem + 0.227vw, 1rem);
    --text-base: clamp(1rem, 0.955rem + 0.227vw, 1.125rem);
    --text-lg: clamp(1.125rem, 1.08rem + 0.227vw, 1.25rem);
    --text-xl: clamp(1.25rem, 1.159rem + 0.455vw, 1.5rem);
    --text-2xl: clamp(1.5rem, 1.318rem + 0.909vw, 2rem);
    --text-3xl: clamp(2rem, 1.636rem + 1.818vw, 3rem);
    --text-4xl: clamp(3rem, 1.636rem + 1.818vw, 6rem);
    --text-5xl: clamp(4rem, 1.636rem + 1.818vw, 9rem);

    /* Custom Typography for Client Feedback */
    --text-hero-header: clamp(
      2.25rem,
      1.5121rem + 1.5374vw,
      3.333rem
    ); /* Scales from 36px to 53.33px (40pt) */
    --text-sub-header: clamp(
      0.875rem,
      0.752rem + 0.3845vw,
      1.333rem
    ); /* Scales from 14px to 21.3px (~16pt) */

    /* Line Heights */
    --leading-tight: 1.2;
    --leading-snug: 1.375;
    --leading-normal: 1.5;
    --leading-relaxed: 1.625;
    --leading-loose: 2;

    /* Letter Spacing */
    --tracking-tight: -0.015em;
    --tracking-normal: 0;
    --tracking-wide: 0.025em;
    --tracking-wider: 0.05em;
    --tracking-widest: 0.1em;

    /* Color Palette - Sophisticated Minimalist */
    --color-primary: rgb(50, 92, 89);
    --color-primary-hover: rgb(40, 82, 79);
    --color-background: #ffffff;
    --color-surface: #fefefe;
    --color-text-primary: #000000;
    --color-text-secondary: rgb(50, 92, 89);
    --color-modal-bg: #f5f4f2;
    --color-overlay: rgba(0, 0, 0, 0.8);

    /*
     * Branding Accent 500 (Base)
     * HSL(17, 72%, 48%) / #B83E1A
     * Contrast vs. dark-bg: 3.4:1 (AA Large)
     * Contrast vs. light-bg: 6.2:1 (AA)
     * Usage: Key CTAs. Large text on dark, any text on light.
     */
    --color-lisbon-dev: hsl(17, 72%, 48%);

    /* Spacing System */
    --space-xxs: clamp(0.5rem, 1vw, 0.75rem);
    --space-xs: clamp(0.75rem, 2vw, 1rem);
    --space-sm: clamp(1rem, 3vw, 1.5rem);
    --space-md: clamp(1.5rem, 4vw, 2rem);
    --space-lg: clamp(2rem, 5vw, 3rem);
    --space-xl: clamp(3rem, 7vw, 4rem);
    --space-2xl: clamp(4rem, 10vw, 6rem);

    /* Design System Spacing - From DESIGN_SYSTEM.md */
    --spacing-xs: 0.5rem;
    --spacing-sm: 1rem;
    --spacing-md: 1.5rem;
    --spacing-lg: 2.5rem;
    --spacing-xl: 3.75rem;
    --spacing-2xl: 5rem;

    /* Wireframe-derived spacings as relative units */
    --spacing-grid-gap-mobile: 1.5rem;
    --spacing-grid-gap-tablet: 4.37%;
    --spacing-grid-gap-desktop: 66px;

    --spacing-container-mobile: 5vw;
    --spacing-container-tablet: 6%;
    --spacing-container-desktop: 8%;

    /* Animation & Transitions */
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
    --transition-slow: 0.5s ease;

    /* Legacy spacing for existing components */
    --card-height: calc(min(calc(100vw - 4rem), calc(1.3rem * 20)) * 1.2);
    --card-width: min(calc(100vw - 4rem), calc(1.3rem * 20));
    --card-gutter: calc(1.3rem * 3);
  }

  /* Container System */
  .container {
    max-width: var(--breakpoint-xl);
    margin: 0 auto;
    padding: 0 var(--spacing-container-desktop);
  }

  /*   @media (max-width: 1200px) {
    .container {
      padding: 0 var(--spacing-container-tablet);
    }
  } */

  @media (max-width: 768px) {
    .container {
      max-width: var(--breakpoint-md);
      margin: 0 auto;
      padding: 0 var(--spacing-container-mobile);
    }
  }

  @media (max-width: 480px) {
    .container {
      padding: 0 5vw;
    }
  }

  /* Portfolio Grid Layout - Mobile-First Responsive */
  .portfolio-grid {
    display: grid;
    gap: var(--spacing-grid-gap-mobile);
    padding: 3rem 0 2rem;
    justify-content: center;
  }

  @media (min-width: 480px) {
    .portfolio-grid {
      gap: 2rem;
      padding: 4rem 0 2.5rem;
    }
  }

  @media (min-width: 768px) {
    .portfolio-grid {
      grid-template-columns: repeat(auto-fit, minmax(280px, 25.26%));
      gap: var(--spacing-grid-gap-tablet);
      padding: 8rem 0 3rem;
    }
  }

  @media (min-width: 1200px) {
    .portfolio-grid {
      grid-template-columns: repeat(auto-fit, 25.26%);
      gap: var(--spacing-grid-gap-tablet);
      padding: 12rem 0 4rem;
    }
  }

  @media (min-width: 1512px) {
    .portfolio-grid {
      grid-template-columns: repeat(auto-fit, 382px);
      gap: var(--spacing-grid-gap-desktop);
      padding: 726px 0 202px;
    }
  }

  /* Portfolio Item */
  .portfolio-item {
    width: 100%;
    position: relative;
    overflow: hidden;
    aspect-ratio: auto;
  }

  .portfolio-item img {
    width: 100%;
    height: auto;
    display: block;
    transition: transform var(--transition-normal);
  }

  .portfolio-item:hover img {
    transform: scale(1.05);
  }

  /* Interactive Elements */
  .interactive-element {
    transition: all var(--transition-normal);
  }

  .interactive-element:hover {
    color: var(--color-primary);
  }

  /* Focus Management */
  .focusable:focus {
  }

  /* Performance-Optimized Font Loading */
  @font-face {
    font-family: "ivypresto-display-optimized";
    src: local("ivypresto-display"), local("Ivy Presto Display");
    font-display: optional; /* Prevents layout shifts for hero content */
    size-adjust: var(--font-fallback-size-adjust);
  }

  /* Hero Section Performance Optimization */
  .hero-header {
    /* Hardware acceleration for animations */
    will-change: transform, opacity;
    transform: translateZ(0);

    /* Reserve space during font loading to prevent CLS */
    min-height: var(--font-hero-min-height);

    /* Optimize for LCP */
    contain: layout style;
  }

  /* Reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .hero-header {
      animation: none !important;
      transition: none !important;
      will-change: auto;
      transform: none;
    }
  }

  /* Base body styling */
  body {
    font-family: var(--font-heading);
    background-color: var(--color-background);
    color: var(--color-text-primary);
  }

  /* View Transitions Styles */
  @view-transition {
    navigation: auto;
  }

  /* Instant transitions after initial load */
  ::view-transition-group(root) {
    animation-duration: 0.2s;
  }

  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0.2s;
  }

  /* Fade transition for project navigation */
  .fade-transition {
    view-transition-name: fade;
  }

  ::view-transition-group(fade) {
    animation-duration: 0.3s;
  }

  ::view-transition-old(fade) {
    animation: fade-out 0.3s ease-out forwards;
  }

  ::view-transition-new(fade) {
    animation: fade-in 0.3s ease-in forwards;
  }

  @keyframes fade-out {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Portfolio grid item transitions */
  .portfolio-item {
    view-transition-name: var(--portfolio-item-id, none);
  }

  /* Shared element transition for portfolio items */
  ::view-transition-group(portfolio-item) {
    animation-duration: 0.4s;
  }

  /* Modal close behavior during transitions */
  [data-dialog] {
    view-transition-name: none;
  }

  /* Ensure modals close during navigation */
  @media (prefers-reduced-motion: no-preference) {
    [data-dialog][open] {
      animation: modal-close 0.2s ease-out forwards;
    }
  }

  @keyframes modal-close {
    from { 
      opacity: 1; 
      transform: scale(1);
    }
    to { 
      opacity: 0; 
      transform: scale(0.95);
    }
  }

  /* Fallback for browsers without view transitions */
  @supports not (view-transition-name: none) {
    .portfolio-item {
      transition: transform var(--transition-normal);
    }
  }
</style>
