---
export interface Props {
  type: 'success' | 'error' | 'warning' | 'info';
  message?: string;
  class?: string;
  id?: string;
}

const {
  type,
  message,
  class: className,
  id = `form-message-${type}`,
} = Astro.props;

// Don't render if no message
if (!message) return null;
---

<div 
  id={id}
  class={`form-message form-message--${type} ${className || ''}`}
  role={type === 'error' ? 'alert' : 'status'}
  aria-live={type === 'error' ? 'assertive' : 'polite'}
  aria-atomic="true"
>
  <div class="form-message__icon" aria-hidden="true">
    {type === 'success' && (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    )}
    {type === 'error' && (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    )}
    {type === 'warning' && (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    )}
    {type === 'info' && (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    )}
  </div>
  
  <div class="form-message__content">
    <p class="form-message__text">{message}</p>
    <slot />
  </div>
</div>

<style>
  .form-message {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: 4px;
    margin: var(--spacing-md) 0;
    border: 1px solid;
    font-family: var(--font-body);
    font-size: var(--text-sm);
    line-height: var(--leading-normal);
  }

  .form-message__icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 1px; /* Align with text baseline */
  }

  .form-message__content {
    flex: 1;
    min-width: 0; /* Allow text to wrap */
  }

  .form-message__text {
    margin: 0;
    word-wrap: break-word;
  }

  /* Success state */
  .form-message--success {
    background-color: #f0fdf4;
    border-color: #22c55e;
    color: #15803d;
  }

  .form-message--success .form-message__icon {
    color: #16a34a;
  }

  /* Error state */
  .form-message--error {
    background-color: #fef2f2;
    border-color: #ef4444;
    color: #dc2626;
  }

  .form-message--error .form-message__icon {
    color: #dc2626;
  }

  /* Warning state */
  .form-message--warning {
    background-color: #fffbeb;
    border-color: #f59e0b;
    color: #d97706;
  }

  .form-message--warning .form-message__icon {
    color: #f59e0b;
  }

  /* Info state */
  .form-message--info {
    background-color: #eff6ff;
    border-color: #3b82f6;
    color: #1d4ed8;
  }

  .form-message--info .form-message__icon {
    color: #2563eb;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .form-message {
      border-width: 2px;
      font-weight: 600;
    }
  }

  /* Reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .form-message {
      transition: none;
    }
  }

  /* Dark mode support (if implemented) */
  @media (prefers-color-scheme: dark) {
    .form-message--success {
      background-color: rgba(34, 197, 94, 0.1);
      color: #4ade80;
    }

    .form-message--error {
      background-color: rgba(239, 68, 68, 0.1);
      color: #f87171;
    }

    .form-message--warning {
      background-color: rgba(245, 158, 11, 0.1);
      color: #fbbf24;
    }

    .form-message--info {
      background-color: rgba(59, 130, 246, 0.1);
      color: #60a5fa;
    }
  }

  /* Mobile optimizations */
  @media (max-width: var(--breakpoint-sm)) {
    .form-message {
      padding: var(--spacing-xs) var(--spacing-sm);
      font-size: var(--text-xs);
    }

    .form-message__icon svg {
      width: 16px;
      height: 16px;
    }
  }
</style>

<script>
  // Auto-dismiss success messages after a delay
  document.addEventListener('DOMContentLoaded', () => {
    const successMessages = document.querySelectorAll('.form-message--success');
    
    successMessages.forEach((message) => {
      // Auto-dismiss after 5 seconds
      setTimeout(() => {
        if (message.parentNode) {
          message.style.opacity = '0';
          message.style.transform = 'translateY(-10px)';
          message.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
          
          setTimeout(() => {
            message.remove();
          }, 300);
        }
      }, 5000);
    });
  });
</script>