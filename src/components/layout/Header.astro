---
export interface Props {
  class?: string;
}

const {
  class: className = '',
} = Astro.props;

const headerClasses = [
  'header-container',
  className
].filter(Boolean).join(' ');
---

<div class={headerClasses}>
  <!-- Minimalist MENU button (top-right fixed) -->
  <button 
    class="menu-button nav-text interactive-element" 
    type="button"
    aria-label="Toggle navigation menu"
    aria-expanded="false"
    aria-controls="slide-header"
  >
    MENU
  </button>

  <!-- Slide-down header -->
  <header class="slide-header" id="slide-header" aria-hidden="true">
    <nav class="slide-nav" role="navigation" aria-label="Main navigation">
      <button 
        class="nav-button about-button"
        onclick="document.getElementById('about-dialog').showModal()"
      >
        About
      </button>
      <a 
        href="/"
        class="nav-button work-button"
        aria-label="View work and projects"
      >
        Works
      </a>
      <button 
        class="nav-button contact-button"
        onclick="document.getElementById('contact-dialog').showModal()"
      >
        Contact
      </button>
    </nav>
  </header>
</div>

<!-- Header functionality script -->
<script>
  class MinimalistHeader {
    menuButton: HTMLElement | null;
    slideHeader: HTMLElement | null;
    isMenuOpen: boolean;
    boundToggleMenu: () => void;

    constructor() {
      this.menuButton = document.querySelector('.menu-button');
      this.slideHeader = document.querySelector('.slide-header');
      this.isMenuOpen = false;
      this.boundToggleMenu = this.toggleMenu.bind(this);
      
      this.init();
    }

    init() {
      if (!this.menuButton || !this.slideHeader) return;

      const mediaQuery = window.matchMedia('(max-width: 768px)');
      
      this.handleViewportChange(mediaQuery); // Initial check
      mediaQuery.addEventListener('change', (e) => this.handleViewportChange(e));

      // Close menu on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isMenuOpen) {
          this.closeMenu();
        }
      });
    }

    handleViewportChange(e: MediaQueryList | MediaQueryListEvent) {
      if (e.matches) {
        // Mobile view: header is always visible
        if (this.slideHeader) {
          this.slideHeader.setAttribute('aria-hidden', 'false');
          this.slideHeader.classList.remove('slide-header--open');
        }
        if (this.menuButton) {
          this.menuButton.removeEventListener('click', this.boundToggleMenu);
        }
      } else {
        // Desktop view: header is toggleable
        if (this.menuButton) {
          this.menuButton.addEventListener('click', this.boundToggleMenu);
        }
        // When switching to desktop, ensure menu is closed initially
        this.closeMenu();
      }
    }

    toggleMenu() {
      if (this.isMenuOpen) {
        this.closeMenu();
      } else {
        this.openMenu();
      }
    }

    openMenu() {
      this.slideHeader.classList.add('slide-header--open');
      this.menuButton.setAttribute('aria-expanded', 'true');
      this.slideHeader.setAttribute('aria-hidden', 'false');
      this.isMenuOpen = true;
      
      // Announce to screen readers
      this.announceToScreenReader('Navigation menu opened');
    }

    closeMenu() {
      this.slideHeader.classList.remove('slide-header--open');
      this.menuButton.setAttribute('aria-expanded', 'false');
      this.slideHeader.setAttribute('aria-hidden', 'true');
      this.isMenuOpen = false;
      
      // Announce to screen readers
      this.announceToScreenReader('Navigation menu closed');
    }

    announceToScreenReader(message: string) {
      // Create or find existing live region for header announcements
      let liveRegion = document.getElementById('header-live-region');
      if (!liveRegion) {
        liveRegion = document.createElement('div');
        liveRegion.id = 'header-live-region';
        liveRegion.setAttribute('aria-live', 'polite');
        liveRegion.setAttribute('aria-atomic', 'true');
        liveRegion.style.position = 'absolute';
        liveRegion.style.left = '-10000px';
        liveRegion.style.width = '1px';
        liveRegion.style.height = '1px';
        liveRegion.style.overflow = 'hidden';
        document.body.appendChild(liveRegion);
      }

      // Clear and set message
      liveRegion.textContent = '';
      setTimeout(() => {
        liveRegion.textContent = message;
      }, 100);
    }
  }

  // Initialize header when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => new MinimalistHeader());
  } else {
    new MinimalistHeader();
  }
</script>

<style>
  .header-container {
    position: relative;
    z-index: 1000;
  }

  /* Minimalist MENU button - positioned top-right */
  .menu-button {
    position: fixed;
    top: var(--spacing-md);
    right: var(--spacing-lg);
    z-index: 1001;
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--spacing-sm);
    font-family: var(--font-alt-heading);
    font-size: var(--text-base);
    font-weight: 400;
    color: var(--color-text-primary);
    letter-spacing: var(--tracking-wider);
    transition: all var(--transition-normal);
  }

  .menu-button:hover {
    color: var(--color-primary);
  }

  /* Slide-down header - Based on wireframe: 85px for 982px viewport = 8.66vh */
  .slide-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 8.66vh;
    background-color: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    transform: translateY(-100%);
    transition: transform var(--transition-slow);
    z-index: 1000;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: var(--spacing-md);
    padding-right: var(--spacing-lg);
    box-sizing: border-box;
  }

  .slide-header--open {
    transform: translateY(0);
  }

  .slide-nav {
    display: flex;
    gap: var(--spacing-2xl);
    align-items: center;
  }

  .nav-button {
    font-family: var(--font-alt-heading);
    font-size: var(--text-base);
    font-weight: 400;
    letter-spacing: var(--tracking-wider);
    color: var(--color-text-primary);
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--spacing-sm) var(--spacing-md);
    transition: all var(--transition-normal);
    position: relative;
  }

  .nav-button::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 1px;
    background-color: var(--color-primary);
    transition: all var(--transition-normal);
    transform: translateX(-50%);
  }

  .nav-button:hover {
    color: var(--color-primary);
  }

  .nav-button:hover::after {
    width: 100%;
  }

  /* Button styling for nav context */
  button.nav-button {
    background: none;
    border: none;
    cursor: pointer;
  }

  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .menu-button {
      display: none;
    }

    .slide-header {
      transform: translateY(0);
      height: 65px;
      background-color: var(--color-background);
      backdrop-filter: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: none;
      justify-content: center;
      align-items: center;
      padding-top: 0;
      padding-right: 0;
    }

    .slide-nav {
      gap: var(--spacing-lg);
    }

    .nav-button {
      font-size: var(--text-base);
      padding: var(--spacing-sm);
    }

    button.nav-button {
      font-size: var(--text-base);
      padding: var(--spacing-sm);
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .slide-header {
      background-color: white;
      border-bottom-color: black;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .slide-header,
    .nav-button,
    .nav-button::after {
      transition: none;
    }
  }
</style>
